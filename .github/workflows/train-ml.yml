import json
import os
import joblib
from sklearn.tree import DecisionTreeClassifier

DATASET_PATH = "ML/ml_dataset_ml.json"
MODEL_PATH = "ML/model.pkl"

# ======================
# LOAD DATASET
# ======================
if not os.path.exists(DATASET_PATH):
    print("‚ùå Dataset ML introuvable")
    exit(0)

with open(DATASET_PATH, "r") as f:
    data = json.load(f)

X = []
y = []

for d in data:
    if d.get("realColor") is None:
        continue

    X.append([
        d.get("temperature", 8),
        d.get("rteConsommation", 55000),
        d.get("horizon", 0),
        d.get("weekday", 0),
        d.get("month", 1)
    ])
    y.append(d["realColor"])

print("üìä √âchantillons ML:", len(X))

if len(X) < 20:
    print("‚ö†Ô∏è Pas assez de donn√©es ML pour entra√Æner")
    exit(0)

# ======================
# TRAIN MODEL
# ======================
model = DecisionTreeClassifier(
    max_depth=6,
    min_samples_leaf=3
)

model.fit(X, y)

# ======================
# SAVE MODEL
# ======================
joblib.dump(model, MODEL_PATH)

print("‚úÖ Mod√®le ML sauvegard√©")
print("üì¶ Taille:", os.path.getsize(MODEL_PATH), "bytes")
